/* ----------------------------------------------------------------------------
 * Easy!Appointments - Open Source Web Scheduler
 *
 * @package     EasyAppointments
 * @author      A.Tselegidis <alextselegidis@gmail.com>
 * @copyright   Copyright (c) 2013 - 2020, Alex Tselegidis
 * @license     http://opensource.org/licenses/GPL-3.0 - GPLv3
 * @link        http://easyappointments.org
 * @since       v1.2.0
 * ---------------------------------------------------------------------------- */
window.BackendCalendarApi=window.BackendCalendarApi||{},function(e){"use strict";e.saveAppointment=function(e,a,t,n){var i=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_appointment",o={csrfToken:GlobalVariables.csrfToken,appointment_data:JSON.stringify(e)};a&&(o.customer_data=JSON.stringify(a)),$.post(i,o).done(function(e){var a=e[0],n=e[1],i=e[2],o=e[3];t&&t(e.status),function(e,a,t,n,i){var o=t.first_name+" "+t.last_name;new QRious({element:document.querySelector("#qr_code"),value:e.hash,size:100,backgroundAlpha:0,foreground:"#000000",level:"H"});let s=$("#qr_code").attr("src");var l=new jsPDF("p","pt",["215","313"]),r=48,p=r+8+3;l.setFont("helvetica"),l.setFontType("bold"),l.setFontSize(12),l.setLineWidth(1.5),l.line(25,3,200,3),l.addImage(s,"png",78,183,80,80),l.setFontSize(16),l.text(20,23,"Hospital Clínico Viedma"),l.text(20,38,"Ficha Nº:"+i),l.setFontSize(8),l.text(20,r,EALang.attention_date),l.text(150,r,EALang.user_id),l.text(20,r+=22,EALang.service),l.text(20,r+=22,EALang.provider),l.text(20,r+=22,EALang.customer),l.text(20,r+=34,EALang.user),l.text(20,r+=22,EALang.booked),l.setFontSize(12),l.text(20,p,e.start_datetime),l.text(150,p,a.user_ci),l.text(20,p+=23,n.name),l.text(20,p+=23,o),l.text(20,p+=23,a.first_name),l.text(20,p+=12,a.last_name),l.text(20,p+=20,e.user_display_name),l.text(20,p+=20,e.book_datetime),l.setFontSize(8),l.text(l.internal.pageSize.getWidth()/2-80,p+=93,EALang.FirstAdmisionSch),l.text(l.internal.pageSize.getWidth()/2-70,p+=8,EALang.SecondAdmisionSch),l.text(l.internal.pageSize.getWidth()/2-80,p+=8,EALang.ThirdAdmisionSch);var d=p+=8;l.line(20,d,200,d),l.save("ficha.pdf")}(a,i,n,o,e.number_ticket)}).fail(function(e,a,t){n&&n()})},e.saveUnavailable=function(e,a,t){var n=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_unavailable",i={csrfToken:GlobalVariables.csrfToken,unavailable:JSON.stringify(e)};$.post(n,i).done(function(e){a&&a(e)}).fail(function(e,a,n){t&&t()})},e.saveWorkingPlanException=function(e,a,t,n,i){var o=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_working_plan_exception",s={csrfToken:GlobalVariables.csrfToken,date:e,working_plan_exception:a,provider_id:t};$.post(o,s).done(function(e){n&&n(e)}).fail(function(e,a,t){i&&i()})},e.deleteWorkingPlanException=function(e,a,t,n){var i=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_delete_working_plan_exception",o={csrfToken:GlobalVariables.csrfToken,date:e,provider_id:a};$.post(i,o).done(function(e){t&&t(e)}).fail(function(e,a,t){n&&n()})},e.getPatientByCI=function(e,a){var t=GlobalVariables.baseUrl+"/index.php/Backend_api/ajax_get_patient_by_ci",n={patientCI:e,complement:a};$.ajax({url:t,type:"GET",data:n,dataType:"json"}).done(function(t){if(0==t.length)$("#form-message").empty(),$("#appointment-message").empty(),$("#save-appointment").prop("disabled",!0),GeneralFunctions.displayMessageBox(EALang.message,EALang.patient_not_found);else if(t.length>0){var n=/[^0-9]+/,i=0;for(!function(e,a){var t=GlobalVariables.baseUrl+"/index.php/Backend_api/ajax_get_patient_reservation",n={patientCI:e,complement:a};$.ajax({url:t,type:"GET",data:n,dataType:"json"}).done(function(e){if(null==e)$("#appointment-message").empty(),GeneralFunctions.displayMessageBox(EALang.message,EALang.patient_not_found);else if(e.length>=1){var e=e[0],a=new Date(e.book_datetime);(function(e,a){var t=!1,n=!1,i=!1;e.getFullYear()==e.getFullYear()&&(t=!0);e.getMonth()===a.getMonth()&&(n=!0);e.getDate()===a.getDate()&&(i=!0);return t==n&&n==i})(a,new Date)&&GeneralFunctions.displayMessageBox(EALang.message,EALang.patient_reserved_already+" "+e.book_datetime)}})}(e,a);i<t.length;){if(t[i].HCL_NUMCI.replace(n,"")==e){$("#first-name").val(t[i].HCL_NOMBRE),$("#last-name").val(t[i].HCL_APPAT+" "+t[i].HCL_APMAT),$("#clinical-story").val(t[i].HCL_CODIGO),$("#phone-number").val(t[i].HCL_TELDOM),$("#save-appointment").prop("disabled",!1);break}i++}}else $("#manage-appointment").find("#first-name, #last-name,#clinical-story").val("")})}}(window.BackendCalendarApi);