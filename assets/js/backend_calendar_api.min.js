/* ----------------------------------------------------------------------------
 * Easy!Appointments - Open Source Web Scheduler
 *
 * @package     EasyAppointments
 * @author      A.Tselegidis <alextselegidis@gmail.com>
 * @copyright   Copyright (c) 2013 - 2020, Alex Tselegidis
 * @license     http://opensource.org/licenses/GPL-3.0 - GPLv3
 * @link        http://easyappointments.org
 * @since       v1.2.0
* ---------------------------------------------------------------------------- */ window.BackendCalendarApi=window.BackendCalendarApi||{},function(e){"use strict";e.saveAppointment=function(e,t,a,n){var i=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_appointment",o={csrfToken:GlobalVariables.csrfToken,appointment_data:JSON.stringify(e)};t&&(o.customer_data=JSON.stringify(t)),$.post(i,o).done(function(e){var t,n,i,o,s,p,r,l,d,c,f=e[0],m=e[1],x=e[2],u=e[3];let g;a&&a(e.status),s=f,p=x,r=m,l=u,d=e.number_ticket,c=r.first_name+" "+r.last_name,new QRious({element:document.querySelector("#qr_code"),value:s.hash,size:100,backgroundAlpha:0,foreground:"#000000",level:"H"}),g=$("#qr_code").attr("src"),t=new jsPDF("p","pt",["215","313"]),i=(n=48)+8+3,t.setFont("helvetica"),t.setFontType("bold"),t.setFontSize(12),t.setLineWidth(1.5),t.line(25,3,200,3),t.addImage(g,"png",78,198,80,80),t.setFontSize(16),t.text(20,23,"Hospital Cl\xednico Viedma"),t.text(20,38,"Ficha N\xba:"+d),t.setFontSize(8),t.text(20,n,EALang.attention_date),t.text(150,n,EALang.user_id),t.text(20,n+=22,EALang.service),t.text(20,n+=22,EALang.provider),t.text(20,n+=22,EALang.customer),t.text(20,n+=34,EALang.user),t.text(20,n+=22,EALang.booked),t.setFontSize(12),t.text(20,i,s.start_datetime),t.text(150,i,p.user_ci),t.text(20,i+=23,l.name),t.text(20,i+=23,c),t.text(20,i+=23,p.first_name),t.text(20,i+=12,p.last_name),t.text(20,i+=23,s.user_display_name),t.text(20,i+=23,s.book_datetime),t.setFontSize(8),t.text(20,i+=108,EALang.FirstAdmisionSch),t.text(20,i+=8,EALang.SecondAdmisionSch),o=i+=8,t.line(20,o,200,o),t.save("ficha.pdf")}).fail(function(e,t,a){n&&n()})},e.saveUnavailable=function(e,t,a){var n=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_unavailable",i={csrfToken:GlobalVariables.csrfToken,unavailable:JSON.stringify(e)};$.post(n,i).done(function(e){t&&t(e)}).fail(function(e,t,n){a&&a()})},e.saveWorkingPlanException=function(e,t,a,n,i){var o=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_working_plan_exception",s={csrfToken:GlobalVariables.csrfToken,date:e,working_plan_exception:t,provider_id:a};$.post(o,s).done(function(e){n&&n(e)}).fail(function(e,t,a){i&&i()})},e.deleteWorkingPlanException=function(e,t,a,n){var i=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_delete_working_plan_exception",o={csrfToken:GlobalVariables.csrfToken,date:e,provider_id:t};$.post(i,o).done(function(e){a&&a(e)}).fail(function(e,t,a){n&&n()})},e.getPatientByCI=function(e,t){var a=GlobalVariables.baseUrl+"/index.php/Backend_api/ajax_get_patient_by_ci";$.ajax({url:a,type:"GET",data:{patientCI:e,complement:t},dataType:"json"}).done(function(a){if(0==a.length)$("#form-message").empty(),$("#appointment-message").empty(),$("#save-appointment").prop("disabled",!0),GeneralFunctions.displayMessageBox(EALang.message,EALang.patient_not_found);else if(a.length>0){var n=/[^0-9]+/,i=0;for(function e(t,a){var n=GlobalVariables.baseUrl+"/index.php/Backend_api/ajax_get_patient_reservation";$.ajax({url:n,type:"GET",data:{patientCI:t,complement:a},dataType:"json"}).done(function(e){if(null==e)$("#appointment-message").empty(),GeneralFunctions.displayMessageBox(EALang.message,EALang.patient_not_found);else if(e.length>=1){var t,a,n,i,o,e=e[0];t=new Date(e.book_datetime),a=new Date,n=!1,i=!1,o=!1,t.getFullYear()===t.getFullYear()&&(n=!0),t.getMonth()===a.getMonth()&&(i=!0),t.getDate()===a.getDate()&&(o=!0),n==i&&i==o&&GeneralFunctions.displayMessageBox(EALang.message,EALang.patient_reserved_already+" "+e.book_datetime)}})}(e,t);i<a.length;){if(a[i].HCL_NUMCI.replace(n,"")==e){$("#first-name").val(a[i].HCL_NOMBRE),$("#last-name").val(a[i].HCL_APPAT+" "+a[i].HCL_APMAT),$("#clinical-story").val(a[i].HCL_CODIGO),$("#phone-number").val(a[i].HCL_TELDOM),$("#save-appointment").prop("disabled",!1);break}i++}}else $("#manage-appointment").find("#first-name, #last-name,#clinical-story").val("")})}}(window.BackendCalendarApi);