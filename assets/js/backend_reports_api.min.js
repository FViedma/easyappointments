/* ----------------------------------------------------------------------------
 * Easy!Appointments - Open Source Web Scheduler
 *
 * @package     EasyAppointments
 * @author      A.Tselegidis <alextselegidis@gmail.com>
 * @copyright   Copyright (c) 2013 - 2020, Alex Tselegidis
 * @license     http://opensource.org/licenses/GPL-3.0 - GPLv3
 * @link        http://easyappointments.org
 * @since       v1.0.0
* ---------------------------------------------------------------------------- */ window.BackendReportsApi=window.BackendReportsApi||{},function(a){function b(){return $("<div/>",{class:"card",html:[$("<div/>",{class:"card-header bg-error",html:[$("<h5/>",{text:EALang.patient_not_found})]}),$("<div/>",{class:"card-text",style:"white-space: pre-line;",text:"Paciente no tiene reserva para el presente d\xeda"}),]})}function c(a,b,c,d,e,f,g){return $("<div/>",{class:"card",html:[$("<div/>",{class:"card-header bg-success",html:[$("<h5/>",{text:EALang.last_appointment})]}),$("<div/>",{class:"card-text",style:"white-space: pre-line;",text:"Paciente: "+a+"\nHistoria Clinica: "+f+"\nCI: "+b+"\nFecha reserva: "+c+"\nEspecialidad: "+d+"\nMedico: "+e+"\nDiagn\xf3stico: "+g}),]})}a.getAppointmentsBySpecialities=function(a,b){var c=GlobalVariables.baseUrl+"/index.php/Backend_api/ajax_get_appointments_by_specialities",d={csrfToken:GlobalVariables.csrfToken,speciality_value:a,date_value:b};$.ajax({url:c,type:"GET",data:d,dataType:"json"}).done(function(a){a.length>0&&function(a){let b={};a.forEach(a=>{b.hasOwnProperty(a.speciality.name+" - "+a.doctor.last_name+" "+a.doctor.first_name)||(b[a.speciality.name+" - "+a.doctor.last_name+" "+a.doctor.first_name]={patients:[]}),b[a.speciality.name+" - "+a.doctor.last_name+" "+a.doctor.first_name].patients.push({name:a.patient.first_name,lastname:a.patient.last_name,clinical_story:a.patient.clinical_story,diagnostic:null==a.notes?"":a.notes,municipality:null==a.municipality?"":a.municipality,medical_center:null==a.medical_center?"":a.medical_center,doc_name:a.doctor.first_name,doc_last_name:a.doctor.last_name,start_datetime:a.start_datetime})});var c=new jsPDF("p","pt","letter"),d=612,e=777;d-=60,e-=60;var g=30,h=30,i=40;Object.entries(b).forEach(([a,f])=>{c.setFont("helvetica"),c.setFontType("bold"),c.setFontSize(10),c.text(30,h,a),Object.entries(f).forEach(([b,a])=>{var f=a.length-1;a.forEach(b=>{if(c.setFont("courier"),c.setFontType("normal"),c.setFontSize(10),c.text(g,i,b.name+" "+b.lastname),c.text(g,i+10,b.clinical_story),c.text(g,i+20,b.start_datetime),c.text(g,i+30,b.diagnostic),c.text(g,i+40,b.municipality),c.text(g,i+50,b.medical_center),a.indexOf(b)<f){var h=g+200+5;h>d?(g=30,(i+=70)>=e&&(c.addPage(),i=30)):g=h}})}),nextYtittle=i,Object.entries(b).findIndex(b=>b.key===a)<Object.keys(b).length-1&&(nextYtittle>e?(c.addPage(),g=30,h=30,i=40):(i+=70,h=i,i+=10,g=30))});var f=c.output("bloburi");$(".preview-pane").attr("src",f)}(a)})},a.getAppointmentByCi=function(a,d){var e=GlobalVariables.baseUrl+"/index.php/Backend_api/ajax_get_appointment_by_ci",f={csrfToken:GlobalVariables.csrfToken,ci_value:a,complement_ci:d};$.ajax({url:e,type:"GET",data:f,dataType:"json"}).done(function(a){if(a.length>0&&"FAILURE"!=a){a=a[0],$("#appointment-message").empty();var d=a.customer.first_name+" "+a.customer.last_name,e=a.provider.first_name+" "+a.provider.last_name;$("#appointment-message").append(c(d,a.customer.user_ci,a.start_datetime,a.service.name,e,a.customer.clinical_story,a.notes))}else $("#appointment-message").empty(),$("#appointment-message").append(b())})},a.getAppointmentByQr=function(a){var d=GlobalVariables.baseUrl+"/index.php/Backend_api/ajax_get_appointment_by_qrHash",e={csrfToken:GlobalVariables.csrfToken,hashCode:a};$.ajax({url:d,type:"GET",data:e,dataType:"json"}).done(function(a){if(a.length>0&&"FAILURE"!=a){a=a[0],$("#appointment-message").empty();var d=a.customer.first_name+" "+a.customer.last_name,e=a.provider.first_name+" "+a.provider.last_name;$("#appointment-message").append(c(d,a.customer.user_ci,a.start_datetime,a.service.name,e,a.customer.clinical_story,a.notes))}else $("#appointment-message").empty(),$("#appointment-message").append(b())})}}(window.BackendReportsApi)