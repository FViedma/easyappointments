/* ----------------------------------------------------------------------------
 * Easy!Appointments - Open Source Web Scheduler
 *
 * @package     EasyAppointments
 * @author      A.Tselegidis <alextselegidis@gmail.com>
 * @copyright   Copyright (c) 2013 - 2020, Alex Tselegidis
 * @license     http://opensource.org/licenses/GPL-3.0 - GPLv3
 * @link        http://easyappointments.org
 * @since       v1.0.0
* ---------------------------------------------------------------------------- */ window.BackendReportsApi=window.BackendReportsApi||{},function(e){function t(){return $("<div/>",{class:"card",html:[$("<div/>",{class:"card-header bg-error",html:[$("<h5/>",{text:EALang.patient_not_found})]}),$("<div/>",{class:"card-text",style:"white-space: pre-line;",text:"Paciente no tiene reserva para el presente d\xeda"}),]})}function a(e,t,a,n,i,s,r){return $("<div/>",{class:"card",html:[$("<div/>",{class:"card-header bg-success",html:[$("<h5/>",{text:EALang.last_appointment})]}),$("<div/>",{class:"card-text",style:"white-space: pre-line;",text:"Paciente: "+e+"\nHistoria Clinica: "+s+"\nCI: "+t+"\nFecha reserva: "+a+"\nEspecialidad: "+n+"\nMedico: "+i+"\nDiagn\xf3stico: "+r}),]})}e.getAppointmentsBySpecialities=function(e,t,a){var n=GlobalVariables.baseUrl+"/index.php/Backend_api/ajax_get_appointments_by_specialities",i={csrfToken:GlobalVariables.csrfToken,speciality_value:e,date_value:t,date_end:a};$.ajax({url:n,type:"GET",data:i,dataType:"json"}).done(function(e){e.data.length>0&&function e(t){let a={};t.forEach(e=>{a.hasOwnProperty(e.speciality.name+" - "+e.doctor.last_name+" "+e.doctor.first_name)||(a[e.speciality.name+" - "+e.doctor.last_name+" "+e.doctor.first_name]={patients:[]}),a[e.speciality.name+" - "+e.doctor.last_name+" "+e.doctor.first_name].patients.push({name:e.patient.first_name,lastname:e.patient.last_name,clinical_story:e.patient.clinical_story,diagnostic:null==e.notes?"":e.notes,municipality:null==e.municipality?"":e.municipality,medical_center:null==e.medical_center?"":e.medical_center,doc_name:e.doctor.first_name,doc_last_name:e.doctor.last_name,start_datetime:e.start_datetime})});var n=new jsPDF("p","pt","letter"),i=612,s=777;i-=60,s-=60;var r=30,c=30,o=40;Object.entries(a).forEach(([e,t])=>{n.setFont("helvetica"),n.setFontType("bold"),n.setFontSize(10),n.text(30,c,e),Object.entries(t).forEach(([e,t])=>{var a=t.length-1;t.forEach(e=>{if(n.setFont("courier"),n.setFontType("normal"),n.setFontSize(10),n.text(r,o,e.name+" "+e.lastname),n.text(r,o+10,e.clinical_story),n.text(r,o+20,e.start_datetime),n.text(r,o+30,e.diagnostic),n.text(r,o+40,e.municipality),n.text(r,o+50,e.medical_center),t.indexOf(e)<a){var c=r+200+5;c>i?(r=30,(o+=70)>=s&&(n.addPage(),o=30)):r=c}})}),nextYtittle=o,Object.entries(a).findIndex(t=>t.key===e)<Object.keys(a).length-1&&(nextYtittle>s?(n.addPage(),r=30,c=30,o=40):(o+=70,c=o,o+=10,r=30))});var p=n.output("bloburi");$(".preview-pane").attr("src",p)}(e.data),$("#quantity").val(e.quantity)})},e.getAppointmentByCi=function(e,n){var i=GlobalVariables.baseUrl+"/index.php/Backend_api/ajax_get_appointment_by_ci",s={csrfToken:GlobalVariables.csrfToken,ci_value:e,complement_ci:n};$.ajax({url:i,type:"GET",data:s,dataType:"json"}).done(function(e){if(e.length>0&&"FAILURE"!=e){e=e[0],$("#appointment-message").empty();var n=e.customer.first_name+" "+e.customer.last_name,i=e.provider.first_name+" "+e.provider.last_name;$("#appointment-message").append(a(n,e.customer.user_ci,e.start_datetime,e.service.name,i,e.customer.clinical_story,e.notes))}else $("#appointment-message").empty(),$("#appointment-message").append(t())})},e.getAppointmentByQr=function(e){var n=GlobalVariables.baseUrl+"/index.php/Backend_api/ajax_get_appointment_by_qrHash",i={csrfToken:GlobalVariables.csrfToken,hashCode:e};$.ajax({url:n,type:"GET",data:i,dataType:"json"}).done(function(e){if(e.length>0&&"FAILURE"!=e){e=e[0],$("#appointment-message").empty();var n=e.customer.first_name+" "+e.customer.last_name,i=e.provider.first_name+" "+e.provider.last_name;$("#appointment-message").append(a(n,e.customer.user_ci,e.start_datetime,e.service.name,i,e.customer.clinical_story,e.notes))}else $("#appointment-message").empty(),$("#appointment-message").append(t())})}}(window.BackendReportsApi);