/* ----------------------------------------------------------------------------
 * Easy!Appointments - Open Source Web Scheduler
 *
 * @package     EasyAppointments
 * @author      A.Tselegidis <alextselegidis@gmail.com>
 * @copyright   Copyright (c) 2013 - 2020, Alex Tselegidis
 * @license     http://opensource.org/licenses/GPL-3.0 - GPLv3
 * @link        http://easyappointments.org
 * @since       v1.0.0
* ---------------------------------------------------------------------------- */ !function(){"use strict";var t=function(){this.enableCancel=!1,this.enableSubmit=!1};t.prototype.setup=function(t){var e=GeneralFunctions.getWeekDayId(GlobalVariables.firstWeekday),n=GeneralFunctions.sortWeekDictionary(t,e);$(".working-plan tbody").empty(),$(".breaks tbody").empty();var a="regular"===GlobalVariables.timeFormat?"h:mm tt":"HH:mm";$.each(n,(function(t,e){var n=this.convertValueToDay(t),r=GeneralFunctions.upperCaseFirstLetter(n);$("<tr/>",{html:[$("<td/>",{html:[$("<div/>",{class:"checkbox form-check",html:[$("<input/>",{class:"form-check-input",type:"checkbox",id:t}),$("<label/>",{class:"form-check-label",text:r,for:t}),]})]}),$("<td/>",{html:[$("<input/>",{id:t+"-start",class:"work-start form-control input-sm"})]}),$("<td/>",{html:[$("<input/>",{id:t+"-end",class:"work-start form-control input-sm"})]})]}).appendTo(".working-plan tbody"),e?($("#"+t).prop("checked",!0),$("#"+t+"-start").val(Date.parse(e.start).toString(a).toUpperCase()),$("#"+t+"-end").val(Date.parse(e.end).toString(a).toUpperCase()),e.breaks.sort(function(t,e){return t.start.localeCompare(e.start)}),e.breaks.forEach(function(t){$("<tr/>",{html:[$("<td/>",{class:"break-day editable",text:r}),$("<td/>",{class:"break-start editable",text:Date.parse(t.start).toString(a).toUpperCase()}),$("<td/>",{class:"break-end editable",text:Date.parse(t.end).toString(a).toUpperCase()}),$("<td/>",{html:[$("<button/>",{type:"button",class:"btn btn-outline-secondary btn-sm edit-break",title:EALang.edit,html:[$("<span/>",{class:"fas fa-edit"})]}),$("<button/>",{type:"button",class:"btn btn-outline-secondary btn-sm delete-break",title:EALang.delete,html:[$("<span/>",{class:"fas fa-trash-alt"})]}),$("<button/>",{type:"button",class:"btn btn-outline-secondary btn-sm save-break d-none",title:EALang.save,html:[$("<span/>",{class:"fas fa-check-circle"})]}),$("<button/>",{type:"button",class:"btn btn-outline-secondary btn-sm cancel-break d-none",title:EALang.cancel,html:[$("<span/>",{class:"fas fa-ban"})]})]})]}).appendTo(".breaks tbody")})):($("#"+t).prop("checked",!1),$("#"+t+"-start").prop("disabled",!0),$("#"+t+"-end").prop("disabled",!0))}).bind(this)),this.editableDayCell($(".breaks .break-day")),this.editableTimeCell($(".breaks").find(".break-start, .break-end"))},t.prototype.setupWorkingPlanExceptions=function(t){for(var e in t){var n=t[e];this.renderWorkingPlanExceptionRow(e,n).appendTo(".working-plan-exceptions tbody")}},t.prototype.editableDayCell=function(t){var e={};e[EALang.sunday]=EALang.sunday,e[EALang.monday]=EALang.monday,e[EALang.tuesday]=EALang.tuesday,e[EALang.wednesday]=EALang.wednesday,e[EALang.thursday]=EALang.thursday,e[EALang.friday]=EALang.friday,e[EALang.saturday]=EALang.saturday,t.editable(function(t,e){return t},{type:"select",data:e,event:"edit",height:"30px",submit:'<button type="button" class="d-none submit-editable">Submit</button>',cancel:'<button type="button" class="d-none cancel-editable">Cancel</button>',onblur:"ignore",onreset:(function(t,e){if(!this.enableCancel)return!1}).bind(this),onsubmit:(function(t,e){if(!this.enableSubmit)return!1}).bind(this)})},t.prototype.editableTimeCell=function(t){t.editable(function(t,e){return t},{event:"edit",height:"30px",submit:$("<button/>",{type:"button",class:"d-none submit-editable",text:EALang.save}).get(0).outerHTML,cancel:$("<button/>",{type:"button",class:"d-none cancel-editable",text:EALang.cancel}).get(0).outerHTML,onblur:"ignore",onreset:(function(t,e){if(!this.enableCancel)return!1}).bind(this),onsubmit:(function(t,e){if(!this.enableSubmit)return!1}).bind(this)})},t.prototype.editableDoctorCell=function(t){var e={};e[0]=EALang.all,GlobalVariables.providers.forEach(function(t){e[t.id]=t.first_name+" "+t.last_name}),t.editable(function(t,e){return t},{type:"select",data:e,event:"edit",height:"30px",submit:'<button type="button" class="d-none submit-editable">Submit</button>',cancel:'<button type="button" class="d-none cancel-editable">Cancel</button>',onblur:"ignore",onreset:(function(t,e){if(!this.enableCancel)return!1}).bind(this),onsubmit:(function(t,e){if(!this.enableSubmit)return!1}).bind(this)})},t.prototype.editableDateCell=function(t){t.editable(function(t,e){return t},{event:"edit",height:"30px",submit:$("<button/>",{type:"button",class:"d-none submit-editable",text:EALang.save}).get(0).outerHTML,cancel:$("<button/>",{type:"button",class:"d-none cancel-editable",text:EALang.cancel}).get(0).outerHTML,onblur:"ignore",onreset:(function(t,e){if(!this.enableCancel)return!1}).bind(this),onsubmit:(function(t,e){if(!this.enableSubmit)return!1}).bind(this)})},t.prototype.editableReasonCell=function(t){t.editable(function(t,e){return t},{type:"text",event:"edit",height:"30px",submit:'<button type="button" class="d-none submit-editable">Submit</button>',cancel:'<button type="button" class="d-none cancel-editable">Cancel</button>',onblur:"ignore",onreset:(function(t,e){if(!this.enableCancel)return!1}).bind(this),onsubmit:(function(t,e){if(!this.enableSubmit)return!1}).bind(this)})},t.prototype.renderWorkingPlanExceptionRow=function(t,e){var n="regular"===GlobalVariables.timeFormat?"h:mm tt":"HH:mm";return $("<tr/>",{data:{date:t,workingPlanException:e},html:[$("<td/>",{class:"working-plan-exception-date",text:GeneralFunctions.formatDate(t,GlobalVariables.dateFormat,!1)}),$("<td/>",{class:"working-plan-exception--start",text:Date.parse(e.start).toString(n)}),$("<td/>",{class:"working-plan-exception--end",text:Date.parse(e.end).toString(n)}),$("<td/>",{html:[$("<button/>",{type:"button",class:"btn btn-outline-secondary btn-sm edit-working-plan-exception",title:EALang.edit,html:[$("<span/>",{class:"fas fa-edit"})]}),$("<button/>",{type:"button",class:"btn btn-outline-secondary btn-sm delete-working-plan-exception",title:EALang.delete,html:[$("<span/>",{class:"fas fa-trash-alt"})]}),]})]})},t.prototype.bindEventHandlers=function(){$(".working-plan tbody").on("click","input:checkbox",function(){var t=$(this).attr("id");!0===$(this).prop("checked")?($("#"+t+"-start").prop("disabled",!1).val("9:00 AM"),$("#"+t+"-end").prop("disabled",!1).val("6:00 PM")):($("#"+t+"-start").prop("disabled",!0).val(""),$("#"+t+"-end").prop("disabled",!0).val(""))}),$(".add-break").on("click",(function(){var t="regular"===GlobalVariables.timeFormat?"h:mm tt":"HH:mm",e=$("<tr/>",{html:[$("<td/>",{class:"break-day editable",text:EALang.sunday}),$("<td/>",{class:"break-start editable",text:Date.parse("12:00:00").toString(t)}),$("<td/>",{class:"break-end editable",text:Date.parse("14:00:00").toString(t)}),$("<td/>",{html:[$("<button/>",{type:"button",class:"btn btn-outline-secondary btn-sm edit-break",title:EALang.edit,html:[$("<span/>",{class:"fas fa-edit"})]}),$("<button/>",{type:"button",class:"btn btn-outline-secondary btn-sm delete-break",title:EALang.delete,html:[$("<span/>",{class:"fas fa-trash-alt"})]}),$("<button/>",{type:"button",class:"btn btn-outline-secondary btn-sm save-break d-none",title:EALang.save,html:[$("<span/>",{class:"fas fa-check-circle"})]}),$("<button/>",{type:"button",class:"btn btn-outline-secondary btn-sm cancel-break d-none",title:EALang.cancel,html:[$("<span/>",{class:"fas fa-ban"})]})]})]}).appendTo(".breaks tbody");this.editableDayCell(e.find(".break-day")),this.editableTimeCell(e.find(".break-start, .break-end")),e.find(".edit-break").trigger("click"),$(".add-break").prop("disabled",!0)}).bind(this)),$(document).on("click",".edit-break",function(){$(this).closest("table").find(".editable").each(function(t,e){e.reset&&e.reset()}),$(this).parent().parent().children().trigger("edit"),$(this).parent().parent().find(".break-start input, .break-end input").timepicker({timeFormat:"regular"===GlobalVariables.timeFormat?"h:mm TT":"HH:mm",currentText:EALang.now,closeText:EALang.close,timeOnlyTitle:EALang.select_time,timeText:EALang.time,hourText:EALang.hour,minuteText:EALang.minutes}),$(this).parent().parent().find(".break-day select").focus();var t=$(this).closest("tr");t.find(".edit-break, .delete-break").addClass("d-none"),t.find(".save-break, .cancel-break").removeClass("d-none"),t.find("select,input:text").addClass("form-control input-sm"),$(".add-break").prop("disabled",!0)}),$(document).on("click",".delete-break",function(){$(this).parent().parent().remove()}),$(document).on("click",".cancel-break",(function(t){var e=t.target,n=$(e).closest("tr");this.enableCancel=!0,n.find(".cancel-editable").trigger("click"),this.enableCancel=!1,$(e).closest("table").find(".edit-break, .delete-break").removeClass("d-none"),n.find(".save-break, .cancel-break").addClass("d-none"),$(".add-break").prop("disabled",!1)}).bind(this)),$(document).on("click",".save-break",(function(t){var e=t.target,n=$(e).closest("tr"),a=Date.parse(n.find(".break-start input").val());a>Date.parse(n.find(".break-end input").val())&&n.find(".break-end input").val(a.addHours(1).toString("regular"===GlobalVariables.timeFormat?"h:mm tt":"HH:mm")),this.enableSubmit=!0,n.find(".editable .submit-editable").trigger("click"),this.enableSubmit=!1,n.find(".save-break, .cancel-break").addClass("d-none"),$(e).closest("table").find(".edit-break, .delete-break").removeClass("d-none"),$(".add-break").prop("disabled",!1);var r=this.get();this.setup(r)}).bind(this)),$(document).on("click",".add-working-plan-exception",(function(){WorkingPlanExceptionsModal.add().done((function(t,e){var n=null;$(".working-plan-exceptions tbody tr").each(function(e,a){if(t===$(a).data("date"))return n=$(a),!1});var a=this.renderWorkingPlanExceptionRow(t,e);n?n.replaceWith(a):a.appendTo(".working-plan-exceptions tbody")}).bind(this))}).bind(this)),$(document).on("click",".edit-working-plan-exception",(function(t){var e=$(t.target).closest("tr"),n=e.data("date"),a=e.data("workingPlanException");WorkingPlanExceptionsModal.edit(n,a).done((function(t,n){e.replaceWith(this.renderWorkingPlanExceptionRow(t,n))}).bind(this))}).bind(this)),$(document).on("click",".delete-working-plan-exception",function(){$(this).closest("tr").remove()}),$(".add-holyday").on("click",(function(){var t="regular"===GlobalVariables.timeFormat?"h:mm tt":"HH:mm",e=new Date,n=e.getFullYear()+"/"+e.getMonth()+"1/"+e.getDate(),a=$("<tr/>",{html:[$("<td/>",{class:"holyday-doctor editable",text:EALang.all}),$("<td/>",{class:"holyday-start editable",text:n+" "+Date.parse("00:00:00").toString(t)}),$("<td/>",{class:"holyday-end editable",text:n+" "+Date.parse("23:59:59").toString(t)}),$("<td/>",{class:"holyday-reason editable",text:EALang.holyday}),$("<td/>",{html:[$("<button/>",{type:"button",class:"btn btn-outline-secondary btn-sm edit-holyday",title:EALang.edit,html:[$("<span/>",{class:"fas fa-edit"})]}),$("<button/>",{type:"button",class:"btn btn-outline-secondary btn-sm delete-holyday",title:EALang.delete,html:[$("<span/>",{class:"fas fa-trash-alt"})]}),$("<button/>",{type:"button",class:"btn btn-outline-secondary btn-sm save-holyday d-none",title:EALang.save,html:[$("<span/>",{class:"fas fa-check-circle"})]}),$("<button/>",{type:"button",class:"btn btn-outline-secondary btn-sm cancel-holyday d-none",title:EALang.cancel,html:[$("<span/>",{class:"fas fa-ban"})]})]})]}).appendTo(".holydays tbody");this.editableDoctorCell(a.find(".holyday-doctor")),this.editableDateCell(a.find(".holyday-start, .holyday-end")),this.editableReasonCell(a.find(".holyday-reason")),a.find(".edit-holyday").trigger("click"),$(".add-holyday").prop("disabled",!0)}).bind(this)),$(document).on("click",".edit-holyday",function(){var t=$(this).closest("table").find(".editable"),e=GeneralFunctions.getWeekDayId(GlobalVariables.firstWeekday);t.each(function(t,e){e.reset&&e.reset()}),$(this).parent().parent().children().trigger("edit"),$(this).parent().parent().find(".holyday-start input, .holyday-end input").datepicker({dateFormat:"dd-mm-yy",firstDay:e,minDate:0,defaultDate:Date.today(),dayNames:[EALang.sunday,EALang.monday,EALang.tuesday,EALang.wednesday,EALang.thursday,EALang.friday,EALang.saturday],dayNamesShort:[EALang.sunday.substr(0,3),EALang.monday.substr(0,3),EALang.tuesday.substr(0,3),EALang.wednesday.substr(0,3),EALang.thursday.substr(0,3),EALang.friday.substr(0,3),EALang.saturday.substr(0,3)],dayNamesMin:[EALang.sunday.substr(0,2),EALang.monday.substr(0,2),EALang.tuesday.substr(0,2),EALang.wednesday.substr(0,2),EALang.thursday.substr(0,2),EALang.friday.substr(0,2),EALang.saturday.substr(0,2)],monthNames:[EALang.january,EALang.february,EALang.march,EALang.april,EALang.may,EALang.june,EALang.july,EALang.august,EALang.september,EALang.october,EALang.november,EALang.december],prevText:EALang.previous,nextText:EALang.next,currentText:EALang.now,closeText:EALang.close}),$(this).parent().parent().find(".holyday-doctor select").focus();var n=$(this).closest("tr");n.find(".edit-holyday, .delete-holyday").addClass("d-none"),n.find(".save-holyday, .cancel-holyday").removeClass("d-none"),n.find("select,input:text").addClass("form-control input-sm"),$(".add-holyday").prop("disabled",!0)}),$(document).on("click",".cancel-holyday",(function(t){var e=t.target,n=$(e).closest("tr");this.enableCancel=!0,n.find(".cancel-editable").trigger("click"),this.enableCancel=!1,$(e).closest("table").find(".edit-holyday, .delete-holyday").removeClass("d-none"),n.find(".save-holyday, .cancel-holyday").addClass("d-none"),$(".add-holyday").prop("disabled",!1)}).bind(this)),$(document).on("click",".delete-holyday",function(){$(this).parent().parent().remove()}),$(document).on("click",".save-holyday",(function(t){var e=$(t.target).closest("tr"),n=Date.parse(e.find(".holyday-start input").val());n>Date.parse(e.find(".holyday-end input").val())&&e.find(".holyday-end input").val(n.addHours(1).toString("regular"===GlobalVariables.timeFormat?"h:mm tt":"HH:mm")),console.log(Date.parse(e.find(".holyday-end input").val()))}).bind(this))},t.prototype.get=function(){var t={};return $(".working-plan input:checkbox").each((function(e,n){var a=$(n).attr("id");!0===$(n).prop("checked")?(t[a]={start:Date.parse($("#"+a+"-start").val()).toString("HH:mm"),end:Date.parse($("#"+a+"-end").val()).toString("HH:mm"),breaks:[]},$(".breaks tr").each((function(e,n){if(this.convertDayToValue($(n).find(".break-day").text())===a){var r=$(n).find(".break-start").text(),s=$(n).find(".break-end").text();t[a].breaks.push({start:Date.parse(r).toString("HH:mm"),end:Date.parse(s).toString("HH:mm")})}}).bind(this)),t[a].breaks.sort(function(t,e){return t.start.localeCompare(e.start)})):t[a]=null}).bind(this)),t},t.prototype.getWorkingPlanExceptions=function(){var t={};return $(".working-plan-exceptions tbody tr").each(function(e,n){var a=$(n);t[a.data("date")]=a.data("workingPlanException")}),t},t.prototype.timepickers=function(t){!1===(t=t||!1)?$(".working-plan input:text").timepicker({timeFormat:"regular"===GlobalVariables.timeFormat?"h:mm TT":"HH:mm",currentText:EALang.now,closeText:EALang.close,timeOnlyTitle:EALang.select_time,timeText:EALang.time,hourText:EALang.hour,minuteText:EALang.minutes,onSelect:function(t,e){var n=Date.parse($(this).parent().parent().find(".work-start").val()),a=Date.parse($(this).parent().parent().find(".work-end").val());n>a&&$(this).parent().parent().find(".work-end").val(n.addHours(1).toString("regular"===GlobalVariables.timeFormat?"h:mm tt":"HH:mm"))}}):$(".working-plan input").timepicker("destroy")},t.prototype.reset=function(){},t.prototype.convertValueToDay=function(t){switch(t){case"sunday":return EALang.sunday;case"monday":return EALang.monday;case"tuesday":return EALang.tuesday;case"wednesday":return EALang.wednesday;case"thursday":return EALang.thursday;case"friday":return EALang.friday;case"saturday":return EALang.saturday}},t.prototype.convertDayToValue=function(t){switch(t){case EALang.sunday:return"sunday";case EALang.monday:return"monday";case EALang.tuesday:return"tuesday";case EALang.wednesday:return"wednesday";case EALang.thursday:return"thursday";case EALang.friday:return"friday";case EALang.saturday:return"saturday"}},window.WorkingPlan=t}();